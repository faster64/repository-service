!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.PullToRefresh=factory()}(this,(function(){function _closestElement(node,selector){var depth=10;do{if(!node||!node.tagName||!depth)return null;if(node.tagName&&node.tagName===selector.toUpperCase())return node;if("#"===selector.charAt()&&node.id===selector.substr(1))return node;if("."===selector.charAt()&&node.classList.contains(selector.substr(1)))return node;depth-=1,node=node.parentNode}while(node.parentNode)}var _ptrMarkup,_ptrStyles,_SETTINGS={},_defaults={distTreshold:60,distMax:80,distReload:50,bodyOffset:20,mainElement:"body",triggerElement:"body",ptrElement:".ptr",classPrefix:"ptr--",cssProp:"min-height",iconArrow:"&#8675;",iconRefreshing:"&hellip;",instructionsPullToRefresh:"Kéo xuống để tả lại",instructionsReleaseToRefresh:"Thả tay để tải lại",instructionsRefreshing:'<i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="color:#4BAC4D">',refreshTimeout:500,getMarkup:function(){return'<div class="__PREFIX__box">\n  <div class="__PREFIX__content">\n    <div class="__PREFIX__icon"></div>\n    <div class="__PREFIX__text"></div>\n  </div>\n</div>'},getStyles:function(){return".__PREFIX__ptr {\n  box-shadow: inset 0 -3px 5px rgba(0, 0, 0, 0.12);\n  pointer-events: none;\n  font-size: 0.85em;\n  font-weight: bold;\n  top: 0;\n  height: 0;\n  transition: height 0.3s, min-height 0.3s;\n  text-align: center;\n  width: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: flex-end;\n  align-content: stretch;\n}\n.__PREFIX__box {\n  padding: 10px;\n  flex-basis: 100%;\n}\n.__PREFIX__pull {\n  transition: none;\n}\n.__PREFIX__text {\n  margin-top: .33em;\n  color: rgba(0, 0, 0, 0.3);\n}\n.__PREFIX__icon {\n  color: rgba(0, 0, 0, 0.3);\n  transition: transform .3s;\n}\n.__PREFIX__release .__PREFIX__icon {\n  transform: rotate(180deg);\n}"},onInit:function(){},onRefresh:function(){return location.reload()},resistanceFunction:function(t){return Math.min(1,t/2.5)}},pullStartY=null,pullMoveY=null,dist=0,distResisted=0,_state="pending",_setup=!1,_enable=!1,_timeout,pulltorefresh;function _update(){var classPrefix=_SETTINGS.classPrefix,ptrElement=_SETTINGS.ptrElement,iconArrow=_SETTINGS.iconArrow,iconRefreshing=_SETTINGS.iconRefreshing,instructionsRefreshing=_SETTINGS.instructionsRefreshing,instructionsPullToRefresh=_SETTINGS.instructionsPullToRefresh,instructionsReleaseToRefresh=_SETTINGS.instructionsReleaseToRefresh,iconEl=ptrElement.querySelector("."+classPrefix+"icon"),textEl=ptrElement.querySelector("."+classPrefix+"text");iconEl.innerHTML="refreshing"===_state?iconRefreshing:iconArrow,"releasing"===_state&&(textEl.innerHTML=instructionsReleaseToRefresh),"pulling"!==_state&&"pending"!==_state||(textEl.innerHTML=instructionsPullToRefresh),"refreshing"===_state&&(textEl.innerHTML=instructionsRefreshing)}function _setupEvents(){var classPrefix=_SETTINGS.classPrefix;function onReset(){var cssProp=_SETTINGS.cssProp,ptrElement=_SETTINGS.ptrElement;ptrElement.classList.remove(classPrefix+"refresh"),ptrElement.style[cssProp]="0px"}window.addEventListener("touchstart",(function(e){var triggerElement=_SETTINGS.triggerElement;clearTimeout(_timeout),window.scrollY||(pullStartY=e.touches[0].screenY),_enable=_closestElement(e.target,triggerElement),_state="pending",_update()})),window.addEventListener("touchmove",(function(e){var ptrElement=_SETTINGS.ptrElement,resistanceFunction=_SETTINGS.resistanceFunction,distMax=_SETTINGS.distMax,distTreshold=_SETTINGS.distTreshold,cssProp=_SETTINGS.cssProp;_enable&&(pullStartY?pullMoveY=e.touches[0].screenY:window.scrollY||(pullStartY=e.touches[0].screenY),"pending"===_state&&(ptrElement.classList.add(classPrefix+"pull"),_state="pulling",_update()),pullStartY&&pullMoveY&&(dist=pullMoveY-pullStartY),dist>0&&(e.preventDefault(),ptrElement.style[cssProp]=distResisted+"px",distResisted=resistanceFunction(dist/distTreshold)*Math.min(distMax,dist),"pulling"===_state&&distResisted>distTreshold&&(ptrElement.classList.add(classPrefix+"release"),_state="releasing",_update()),"releasing"===_state&&distResisted<distTreshold&&(ptrElement.classList.remove(classPrefix+"release"),_state="pulling",_update())))}),{passive:!1}),window.addEventListener("touchend",(function(){var ptrElement=_SETTINGS.ptrElement,onRefresh=_SETTINGS.onRefresh,refreshTimeout=_SETTINGS.refreshTimeout,distTreshold=_SETTINGS.distTreshold,distReload=_SETTINGS.distReload,cssProp=_SETTINGS.cssProp;"releasing"===_state&&distResisted>distTreshold?(_state="refreshing",ptrElement.style[cssProp]=distReload+"px",ptrElement.classList.add(classPrefix+"refresh"),_timeout=setTimeout((function(){var retval=onRefresh(onReset);retval&&"function"==typeof retval.then&&retval.then((function(){return onReset()})),retval||onReset.length||onReset()}),refreshTimeout)):(_state="pending",ptrElement.style[cssProp]="0px"),_update(),ptrElement.classList.remove(classPrefix+"release"),ptrElement.classList.remove(classPrefix+"pull"),pullStartY=pullMoveY=null,dist=distResisted=0}))}function _run(){var mainElement=_SETTINGS.mainElement,getMarkup=_SETTINGS.getMarkup,getStyles=_SETTINGS.getStyles,classPrefix=_SETTINGS.classPrefix,onInit=_SETTINGS.onInit;if(!_SETTINGS.ptrElement){var ptr=document.createElement("div");mainElement!==document.body?mainElement.parentNode.insertBefore(ptr,mainElement):document.body.insertBefore(ptr,document.body.firstChild),ptr.classList.add(classPrefix+"ptr"),ptr.innerHTML=getMarkup().replace(/__PREFIX__/g,classPrefix),_SETTINGS.ptrElement=ptr}var styleEl=document.createElement("style");styleEl.innerText=getStyles().replace(/__PREFIX__/g,classPrefix).replace(/\s+/g," "),document.head.appendChild(styleEl),"function"==typeof onInit&&onInit(_SETTINGS)}return{init:function init(options){void 0===options&&(options={}),Object.keys(_defaults).forEach((function(key){_SETTINGS[key]=options[key]||_defaults[key]})),"string"==typeof _SETTINGS.mainElement&&(_SETTINGS.mainElement=document.querySelector(_SETTINGS.mainElement)),"string"==typeof _SETTINGS.ptrElement&&(_SETTINGS.ptrElement=document.querySelector(_SETTINGS.ptrElement)),_setup||(_setupEvents(),_setup=!0),_run()}}}));